<!-- Todo: make prettier once get more expirence with css; consider adding animations -->
 <!-- Hi Luke  -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(hopefully) Secure Login System - </title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            box-sizing: border-box;
        }
        
        button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }
        
        .alert {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid;
        }
        
        .alert-success {
            background: #f5f5f5;
            color: #155724;
        }
        
        .alert-error {
            background: #f5f5f5;
            color: #721c24;
        }
        
        .alert-warning {
            background: #f5f5f5;
            color: #856404;
        }
        
        .strength-bar {
            height: 5px;
            background: #ddd;
            margin: 5px 0;
        }
        
        .strength-bar-fill {
            height: 100%;
            transition: width 0.3s;
        }
        
        .user-info {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen">
            <h2>Welcome, Please Login or Signup below</h2>
            <div id="loginAlert"></div>
            
            <form id="loginForm">
                <label>Email:</label>
                <input type="email" id="loginEmail" required>
                
                <label>Password:</label>
                <input type="password" id="loginPassword" required>
                <button type="button" onclick="togglePassword('loginPassword')">Show/Hide</button>
                
                <button type="submit">Login</button>
            </form>
            
            <a href="#" onclick="showScreen('forgotScreen')">Forgot Password?</a> | 
            <a href="#" onclick="showScreen('signupScreen')">Sign Up</a>
        </div>
        
        <!-- Signup Screen -->
        <div id="signupScreen" class="screen hidden">
            <h1>Create Account</h1>
            <div id="signupAlert"></div>
            
            <form id="signupForm">
                <label>Full Name:</label>
                <input type="text" id="signupName" required>
                
                <label>Email:</label>
                <input type="email" id="signupEmail" required>
                
                <label>Phone:</label>
                <input type="tel" id="signupPhone" required>
                
                <label>Password:</label>
                <input type="password" id="signupPassword" required>
                <div class="strength-bar">
                    <div class="strength-bar-fill" id="strengthBar"></div>
                </div>
                <span id="strengthText"></span>
                <br>
                <br>
                <label>Confirm Password:</label>
                <input type="password" id="signupConfirmPassword" required>
                
                <button type="submit">Create Account</button>
            </form>
            
            <a href="#" onclick="showScreen('loginScreen')">Back to Login</a>
        </div>
        
        <!-- Forgot Password Screen -->
        <div id="forgotScreen" class="screen hidden">
            <h1>Reset Password</h1>
            <div id="forgotAlert"></div>
            
            <form id="forgotForm">
                <label>Email:</label>
                <input type="email" id="forgotEmail" required>
                
                <button type="submit">Send Reset Code</button>
            </form>
            <footer><strong>You will have 5 seconds to save your reset code</strong></footer>
            <br>
            <br>
            <a href="#" onclick="showScreen('loginScreen')">Back to Login</a>
           
        </div>
        
        <!-- Reset Password Screen -->
        <div id="resetScreen" class="screen hidden">
            <h1>Enter New Password</h1>
            <div id="resetAlert"></div>
            
            <form id="resetForm">
                <label>Reset Code:</label>
                <input type="text" id="resetCode" required>
                
                <label>New Password:</label>
                <input type="password" id="resetPassword" required>
                
                <label>Confirm New Password:</label>
                <input type="password" id="resetConfirmPassword" required>
                
                <button type="submit">Reset Password</button>
            </form>
            
            <a href="#" onclick="showScreen('loginScreen')">Back to Login</a>
         
        </div>
        
        <!-- Dashboard Screen -->
        <div id="dashboardScreen" class="screen hidden">
            <h1>User Dashboard</h1>
            <div class="user-info" id="userInfo"></div>
            <button onclick="logout()">Logout</button>
        </div>
        

    <script>
        let storedEmail = '';
        
        // Password Strength Checker
        function checkPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\0-9/.test(password)) strength++;
            if (/[^a-zA-Z\d]/.test(password)) strength++;
            
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            if (strength <= 2) {
                strengthBar.style.width = '33%';
                strengthBar.style.background = 'red';
                strengthText.textContent = 'Weak';
            } else if (strength <= 4) {
                strengthBar.style.width = '66%';
                strengthBar.style.background = 'orange';
                strengthText.textContent = 'Medium';
            } else {
                strengthBar.style.width = '100%';
                strengthBar.style.background = 'green';
                strengthText.textContent = 'Strong';
            }
            
            return strength;
        }
        
        // UI 
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            //setTimeout(() => container.innerHTML = '', 10000);
        }
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        // Login 
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('loginAlert', 'Login successful!', 'success');
                    displayDashboard(data.user);
                    showScreen('dashboardScreen');
                } else {
                    showAlert('loginAlert', data.message, 'error');
                }
            } catch (error) {
                showAlert('loginAlert', 'Error connecting to server!', 'error');
            }
        });
        
        // Signup 
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim().toLowerCase();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showAlert('signupAlert', 'Passwords do not match!', 'error');
                return;
            }
            
            if (checkPasswordStrength(password) < 3) {
                showAlert('signupAlert', 'Password too weak!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, phone, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('signupAlert', data.message + ' Redirecting...', 'success');
                    setTimeout(() => {
                        showScreen('loginScreen');
                        document.getElementById('loginEmail').value = email;
                    }, 2000);
                } else {
                    showAlert('signupAlert', data.message, 'error');
                }
            } catch (error) {
                showAlert('signupAlert', 'Error connecting to server!', 'error');
            }
        });
        
        // Forgot Password 
        document.getElementById('forgotForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
            storedEmail = email;
            
            try {
                const response = await fetch('/api/forgot-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                showAlert('forgotAlert', data.message, 'success');
                
                setTimeout(() => {
                    showScreen('resetScreen');
                }, 5000);
            } catch (error) {
                showAlert('forgotAlert', 'Error connecting to server!', 'error');
            }
        });
        
        // Reset Password 
        document.getElementById('resetForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const code = document.getElementById('resetCode').value.trim();
            const newPassword = document.getElementById('resetPassword').value;
            const confirmPassword = document.getElementById('resetConfirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showAlert('resetAlert', 'Passwords do not match!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: storedEmail, code, newPassword })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('resetAlert', data.message + ' Redirecting...', 'success');
                    setTimeout(() => {
                        showScreen('loginScreen');
                        document.getElementById('loginEmail').value = storedEmail;
                    }, 2000);
                } else {
                    showAlert('resetAlert', data.message, 'error');
                }
            } catch (error) {
                showAlert('resetAlert', 'Error connecting to server!', 'error');
            }
        });
        
        // Dashboard 
        function displayDashboard(user) {
            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <p><strong>Name:</strong> ${user.name}</p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Phone:</strong> ${user.phone}</p>
                <p><strong>Account Created:</strong> ${new Date(user.createdAt).toLocaleDateString()}</p>
            `;
        }
        
        function logout() {
            showScreen('loginScreen');
            document.getElementById('loginForm').reset();
        }
        
        // Password strength checker for signup
        document.getElementById('signupPassword').addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });
    </script>
</body>
</html>
